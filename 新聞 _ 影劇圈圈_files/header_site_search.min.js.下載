var now_searchTxtE;
$(function(){function p(a){""!=a.trim()&&h&&(a={search:a,search_page:g,block_status:0,block_list:""},$(".siteSearchLoading").show(),h=!1,$.post(k+"ajax/works/search_works/",a,function(a){"empty"!=a?(1==g&&$(".seScroller").empty(),y(JSON.parse(a))):($("#searchResultBox").hide(),$(".searchResultBox_arrow").hide(),$(".seScroller").empty(),h=!1,"undefined"!=typeof ssScroll&&null!=ssScroll&&ssScroll.refresh(),$(".seScroller").append("<ul id='site_search_list' style='list-style:none;margin:0px;'></ul>"),$(".siteSearchLoading").hide())}))}
function y(a){$("#searchResultBox").is(":hidden")&&($("#searchResultBox").show(),now_searchArrowE.show(),$(".seScroller").height($("#searchResultBox").height()-50));q();var d=0,b="";1==g&&(b+='<ul id="site_search_list" class="mmScroller" style="list-style:none;margin:0px;" >');for(var c=0;c<a.length;c++){d+=1;m+=1;b+='<li id="site_search_scroll_item_'+m+'" data-sid="'+m+'" class="sis_li">';b="undefined"!=typeof a[c].fbpa_status?b+('<a href="javascript:void(0);" class="site_search_item" data-wid="'+
a[c].wid+'" data-title="'+a[c].title+'" data-fbpa_status="'+a[c].fbpa_status+'">'):b+('<a href="javascript:void(0);" class="site_search_item" data-wid="'+a[c].wid+'" data-title="'+a[c].title+'">');b+="<div>";b+="<h2>";b+="<p>"+a[c].title+"</p>";b+="<p>"+a[c].type;"empty"!=a[c].year&&(b+=" | "+a[c].year);b+="</p>";b+="</h2>";"mvmv_sub_title_empty"!=a[c].sub_title&&(b+="<span>"+a[c].sub_title+"</span>");var b=b+"<span>",f=0,e="all";"empty"!=a[c].manCount&&(b+=a[c].man[0],f+=1,e="w");0<f&&"empty"!=a[c].womanCount?
(b+="\u3001"+a[c].woman[0],f+=1,e="m"):"empty"!=a[c].womanCount?(b+=a[c].woman[0],f+=1,1==f&&2<=a[c].womanCount&&(b+="\u3001"+a[c].woman[1],f+=1)):2<=a[c].manCount&&(b+="\u3001"+a[c].man[1],f+=1);2>f&&("m"!=e&&"all"!=e||"empty"==a[c].msCount||2==f||(b=0==f?b+a[c].ms[0]:b+("\u3001"+a[c].ms[0]),f+=1),"w"!=e&&"all"!=e||"empty"==a[c].wsCount||2==f||(b=0==f?b+a[c].ws[0]:b+("\u3001"+a[c].ws[0]),f+=1),"empty"!=a[c].oCount&&(0==f?(b+=a[c].o[0],f+=1):2!=f&&(b+="\u3001"+a[c].o[0],f+=1),2!=f&&(b+="\u3001"+a[c].o[1],
f+=1)));b+="</span>";b+="</div>";b+="<div>";b=""!=a[c].cover?b+('<img class="ssl_img" src="'+a[c].cover+'" title = "'+a[c].title+' | \u5f71\u5287\u5708\u5708" />'):b+('<img class="ssl_img" src="'+k+'img/tagNoPic.jpg" />');b+="</div>";b+="</a>";b+="</li>"}1==g?(b+="</ul>",$(".seScroller").append(b)):$("#site_search_list").append(b);r();setTimeout(function(){1==g?(ssScroll=new IScroll(".seScroller",{mouseWheel:!0,click:!0,scrollbars:!0,interactiveScrollbars:!0,shrinkScrollbars:"clip"}),ssScroll.on("scrollStart",
function(){now_searchTxtE.blur()}),ssScroll.on("scrollEnd",function(){ssScroll.y<=.9*ssScroll.maxScrollY&&h&&(g+=1,p(l))})):ssScroll.refresh()},300);$(".ssl_img").on("load",function(){"undefined"!=typeof ssScroll&&null!=ssScroll&&ssScroll.refresh()});setTimeout(function(){$("#hidden_sw_item").hide()},300);sw_start=15*(g-1)+1;sw_end=15*(g-1)+d+1;z(sw_start,sw_end,a[0].sw_rows);$(".siteSearchLoading").hide();n=$(".site_search_item").length}function t(a){"undefined"!=typeof ga&&ga("send","event","\u5168\u7ad9\u641c\u5c0b",
"\u9ede\u64ca",now_searchTxtE.val());setTimeout(function(){window.location.href=k+"db/program/"+a},300)}function A(a){swtLength=now_searchTxtE.val().length;if(1==now_searchTxtE.length)switch(window.event?a.keyCode:a.which){case 38:--e;0>e&&(e=0);a.preventDefault();u();break;case 40:e+=1;e>n&&(e=n);a.preventDefault();u();break;case 13:0==e?""!=now_searchTxtE.val().trim()&&("undefined"!=typeof ga&&ga("send","event","\u5168\u7ad9\u641c\u5c0b","\u9ede\u64ca",now_searchTxtE.val()),setTimeout(function(){window.location.href=
k+"search/category/all?kw="+now_searchTxtE.val().trim()},300)):$("#site_search_scroll_item_"+e).find("a").click();break;case 27:close_swrb()}}function u(){$(".sis_li.mmHover").removeClass("mmHover");$("#site_search_scroll_item_"+e).addClass("mmHover");"undefined"!=typeof ssScroll&&null!=ssScroll&&(0!=e&&ssScroll.scrollToElement("#site_search_scroll_item_"+e,null,null,!0),setTimeout(function(){ssScroll.y<=.9*ssScroll.maxScrollY&&h&&(g+=1,p(l))},300))}function z(a,d,b){0==b&&(h=!1);h=d>=b?!1:!0}function q(){var a=
/margin-left: [0-9]*px;/;$("#searchResultBox").attr("style",$("#searchResultBox").attr("style").replace(a,""));a=/right: [0-9]*px;/;$("#searchResultBox").attr("style",$("#searchResultBox").attr("style").replace(a,""));if(0==$("#searchResultBox").is(":hidden"))if($("#mmHeader .wrapper").width(),1==$("#mmSearchBarFull").is(":hidden"))if(470>=window.innerWidth)now_searchTxtE.val(""),$("#searchResultBox").hide(),$(".searchResultBox_arrow").hide();else{var d=$("#searchResultBox").width();now_searchTxtE.width()<
d?(a=document.body.clientWidth,d=$("#mmSearchBar .site_search_btn").offset().left,d=a-d-35,a=/margin-left: [0-9]*px;/,$("#searchResultBox").attr("style",$("#searchResultBox").attr("style").replace(a,"")),$("#searchResultBox").css("right",d+"px")):(d=now_searchTxtE.offset().left,a=/right: [0-9]*px;/,$("#searchResultBox").attr("style",$("#searchResultBox").attr("style").replace(a,"")),$("#searchResultBox").css("margin-left",d))}else 370>=window.innerWidth?(a=/margin-left: [0-9]*px;/,$("#searchResultBox").attr("style",
$("#searchResultBox").attr("style").replace(a,""))):(d=now_searchTxtE.offset().left,a=/right: [0-9]*px;/,$("#searchResultBox").attr("style",$("#searchResultBox").attr("style").replace(a,"")),$("#searchResultBox").css("margin-left",d))}function r(){if(!$("#searchResultBox").is(":hidden")){var a=$("#site_search_list").height(),d=$(".seScroller").height(),b=/height: [0-9]*px;/;$("#searchResultBox").attr("style",$("#searchResultBox").attr("style").replace(b,""));$(".seScroller").attr("style",$(".seScroller").attr("style").replace(b,
""));a<=d?($("#searchResultBox").height(a+55),$(".seScroller").height(a)):$(".seScroller").height($("#searchResultBox").height()-55)}}var k=temp_url,h=!0,l="",v,g=1,m=0;$(document).on("input propertychange",".site_search_text",function(){"site_search_text_desktop"==now_searchTxtE.attr("id")?$("#site_search_text_mobile").val(now_searchTxtE.val()):$("#site_search_text_desktop").val(now_searchTxtE.val());var a=now_searchTxtE.val().trim();$("#siteSearchMoreTxt").html("\u67e5\u770b\u66f4\u591a\u300c"+
a);l="";window.clearTimeout(v);""==a&&(h=!1,$(".seScroller").empty(),$("#searchResultBox").hide(),$(".searchResultBox_arrow").hide());g=1;0!=a.length&&l!=a&&""!=a&&(v=setTimeout(function(){l=a;n=e=m=0;h=!0;p(a)},350))});var w=!0;$(document).on("click",".site_search_item",function(){var a=$(this);if(w){w=!1;var d=a.data("wid");a.data("fbpa_status")?(d=a.data("wid"),$.post(http_url+"ajax/event/burstPoint_search_click",{program_id:d,_token:token},function(a){t(d)})):t(d)}});$(".site_search_text").on("keydown",
function(a){A(a)});var e=0,n=0;$(document).on("mouseenter",".sis_li",function(){$(".sis_li.mmHover").removeClass("mmHover");e=$(this).data("sid");$("#site_search_scroll_item_"+e).addClass("mmHover")});$(window).load(function(){$(window).resize()});var x="";$(window).resize(function(){window.clearTimeout(x);x=setTimeout(function(){resize_site_search();q();r()},1)});$(".site_search_btn").click(function(){var a=$(this).data("uat");if("desktop"==a)var d=$("#site_search_text_desktop").val().trim();else"mobile"==
a&&(d=$("#site_search_text_mobile").val().trim());""!=d&&(window.location.href=k+"search/category/all?kw="+d)});$("#searchIcon").click(function(){$("#mmSearchBarFull").show();resize_site_search();now_searchTxtE.focus()});$("#mmSearchBarFull_close").click(function(){$("#mmSearchBarFull").hide();$(".site_search_text").val();$(window).resize()});$(document).click(function(a){a=$(a.target);a.is("#searchResultBox *")||a.is("#site_search_text_desktop")||a.is("#site_search_text_mobile")||close_searchResultBox()});
$(document).on("click","#siteSearchMoreA",function(){"undefined"!=typeof ga&&ga("send","event","\u5168\u7ad9\u641c\u5c0b","\u9ede\u64ca",now_searchTxtE.val());setTimeout(function(){window.location.href=k+"search/category/all?kw="+now_searchTxtE.val().trim()},300)})});function close_searchResultBox(){$("#searchResultBox").hide();$(".searchResultBox_arrow").hide()};