$(function(){function h(e){d=!1;var f={page:e,category:c,search:g,pageLimit:b};$.post(dynamic_site_url+"ajax/news/get",f,function(b){'"empty"'==b?(d=!1,1==a&&($("#nwes_search_count").html("\u5df2\u641c\u5c0b\u5230 0 \u7b46\u8cc7\u8a0a"),$("#nwes_search_count").show()),$("#newsIdxLoading").hide()):(b=JSON.parse(b),j(b))})}function j(b){if("empty"==b)return 1==a&&($("#nwes_search_count").html("\u5df2\u641c\u5c0b\u5230 0 \u7b46\u8cc7\u8a0a"),$("#nwes_search_count").show(),$("#newsIdxLoading").hide()),!1;for(var c="",e=0;e<b.length;e++)c+='<a href="'+dynamic_site_url+"news/view/"+b[e].news_id+"?nipage="+a+'" class="mmNewsBox newsItem" id="mmNews_'+b[e].news_id+'" data-nid="'+b[e].news_id+'">',c+="\u96fb\u5f71"==b[e].news_type?'<div class="mmSort">'+b[e].news_type+"</div>":'<div class="mmSort TV">'+b[e].news_type+"</div>",b[e].hot&&(c+='<div class="mmHot">HOT</div>'),c+='<img src="'+b[e].cover+'" title="'+b[e].img_title+'" alt="'+b[e].img_title+'" class="newsLoadedImg" />',c+='<div class="mmNewsBoxCont">',c+="<h2>"+b[e].title+"<span>"+b[e].fb_shares+" \u5206\u4eab</span></h2>",c+="<p>"+b[e].content+"</p>",c+="</div>",c+="</a>";$("#mmNewsList").append(c);var g=$("#mmNewsList");g.masonry({itemSelector:".mmNewsBox"}),$(g).masonry("reloadItems"),$(g).masonry("layout"),$(".newsLoadedImg").each(function(){$(this).imagesLoaded(function(){setTimeout(function(){$(g).masonry(),1==a&&setTimeout(function(){$(g).masonry()},1200),$("#newsIdxLoading").hide()},200)}),$(this).removeClass("newsLoadedImg")}),d=!0,f?$("#nwes_search_count").html("\u5df2\u641c\u5c0b\u5230 "+b[0].newsCount+" \u7b46\u8cc7\u8a0a").show():$("#nwes_search_count").hide()}function l(){$("#news_search_txt").css("width","100px");var a=document.body.clientWidth,b=$("#news_search_txt").parent().width();$("#newsIdx_search_btn").width();if("desktop"==$(".ua_type").val())var d=463;else var d=480;if(d>a){var e=b-45;$("#news_search_txt").css("max-width",e+"px"),o()&&$("#mmNewsHot").is(":hidden")&&(e-=10)}else{var e=b-45-2;$("#news_search_txt").removeAttr("style"),o()&&$("#mmNewsHot").is(":hidden")&&(e-=18)}f&&(e-=45),$("#news_search_txt").css("width",e+"px")}function m(a,b){var c=location.href;c.match("/page/")&&(c=c.split("/page/"),c=c[0],history.replaceState("","",c));var d=a,e=new Array;if(""!=d){var f=d,g=f.split("?");for(g=g[1],g=g.split("&"),i=0;i<g.length;i++)tt=g[i].split("="),t1=tt[0],t2=tt[1],e[t1]=t2}var h=b;if("nwesIdx_search_empty"!=$("#news_search").val())var j=location.hostname+location.pathname+"?sk="+$("#news_search").val()+"&page="+e.nipage+"#"+h;else var j=location.hostname+location.pathname+"?page="+e.nipage+"#"+h;j.match("//")&&(j=j.replace("//","/")),j=location.protocol+"//"+j,history.replaceState("","",j),window.location.href=a}function n(){if(""!=location.hash){var a=location.hash;a=a.split("#"),a=a[1];var b=$("#mmNews_"+a);$("html,body").animate({scrollTop:b.offset().top-50},100),console.log(b);var c=location.href;c=c.split("#"),c=c[0],history.replaceState("","",c)}}function o(){var c,a={},b=navigator.userAgent.toLowerCase();return(c=b.match(/rv:([\d.]+)\) like gecko/))?a.ie=c[1]:(c=b.match(/msie ([\d.]+)/))?a.ie=c[1]:(c=b.match(/firefox\/([\d.]+)/))?a.firefox=c[1]:(c=b.match(/chrome\/([\d.]+)/))?a.chrome=c[1]:(c=b.match(/opera.([\d.]+)/))?a.opera=c[1]:(c=b.match(/version\/([\d.]+).*safari/))?a.safari=c[1]:0,a.ie?!0:!1}var a=$("#news_page").val(),b=20,c=$("#news_category").val(),d=!0;if("nwesIdx_search_empty"!=$("#news_search").val()){var f=!0,g=$("#news_search").val();$("#newsIdx_search_btn").addClass("on"),$("#newsIdx_search_cancelBtn").show(),$("#news_search_txt").val($("#news_search").val()),$("#nwes_search_count").show()}else var f=!1,g="";$(window).ready(function(){l(),$(".fixTop").hide(),$(".scrollLoading").scrollLoading(),1==a?$(".mmExpand").hide():$(".mmExpand").show()}),$(window).ready(function(){switch($(".box1 *").removeClass("on"),c){case"all":$(".box1 div").eq(0).addClass("on");break;case"movie":$(".box1 div").eq(1).addClass("on");break;case"tv":$(".box1 div").eq(2).addClass("on")}switch($(".nims a").show(),c){case"all":$("#nims_item a").eq(0).hide(),$("#nims_txt").html($("#nims_item a").eq(0).html());break;case"movie":$("#nims_item a").eq(1).hide(),$("#nims_txt").html($("#nims_item a").eq(1).html());break;case"tv":$("#nims_item a").eq(2).hide(),$("#nims_txt").html($("#nims_item a").eq(2).html())}$("#mmNewsList").css("height",$("#mmNewsHot").height())}),$(window).scroll(function(){var b=$(window).scrollTop();b+$(window).height()>=document.body.scrollHeight-document.body.scrollHeight*(1-.95)&&d&&($("#newsIdxLoading").show(),a=parseInt(a)+1,h(a)),b>200?$(".fixTop").show():$(".fixTop").hide()}),$(".box1").click(function(b){$("#newsIdxLoading").show(),$(".box1 *").removeClass("on"),$(b.target).addClass("on"),a=1,$(".mmExpand").hide(),c=$(b.target).data("category"),$("#news_category").val(c),$("#mmNewsList").empty(),f=!1,g="",$("#news_search_txt").val(""),$("#newsIdx_search_btn").removeClass("on"),$("#newsIdx_search_cancelBtn").hide(),l();var d={time:(new Date).getTime()};switch($(b.target).data("category")){case"all":window.history.replaceState(d,"",dynamic_site_url+"news"),"undefined"!=typeof ga&&ga("send","event","\u65b0\u805e\u9996\u9801","\u9ede\u64ca","\u5168\u90e8");break;case"movie":window.history.replaceState(d,"",dynamic_site_url+"news/category/movie"),"undefined"!=typeof ga&&ga("send","event","\u65b0\u805e\u9996\u9801","\u9ede\u64ca","\u96fb\u5f71");break;case"tv":window.history.replaceState(d,"",dynamic_site_url+"news/category/tv"),"undefined"!=typeof ga&&ga("send","event","\u65b0\u805e\u9996\u9801","\u9ede\u64ca","\u96fb\u8996\u5287")}h(a)});var k=!1;$("#nims").click(function(){k?($("#nims_item").hide(),k=!1):($("#nims_item").show(),k=!0)}),$("#nims a").click(function(b){$("#nims a").show();var d=$(b.target);d.hide(),a=1,c=d.data("category"),$(".mmExpand").hide(),f=!1,g="",$("#news_search_txt").val(""),$("#newsIdx_search_btn").removeClass("on"),$("#newsIdx_search_cancelBtn").hide(),l(),$("#mmNewsList").empty();var e={time:(new Date).getTime()};switch(d.data("category")){case"all":window.history.replaceState(e,"",dynamic_site_url+"news"),$("#nims_txt").html("\u5168\u90e8");break;case"movie":window.history.replaceState(e,"",dynamic_site_url+"news/category/movie"),$("#nims_txt").html("\u96fb\u5f71");break;case"tv":window.history.replaceState(e,"",dynamic_site_url+"news/category/tv"),$("#nims_txt").html("\u96fb\u8996\u5287")}$("#newsIdxLoading").show(),h(a)}),$("#news_search_txt").on("keypress",function(a){var b=window.event?a.keyCode:a.which;13==b&&$("#newsIdx_search_btn").click()}),$("#newsIdx_search_btn").on("click",function(){if($("#newsIdxLoading").show(),g=$("#news_search_txt").val().trim(),""!=g){f=!0,$("#mmNewsList").empty(),a=1,d=!0,$(".mmExpand").hide(),$(this).addClass("on"),$("#newsIdx_search_cancelBtn").show(),l();var b={time:(new Date).getTime()};switch(c){case"all":window.history.replaceState(b,"",dynamic_site_url+"news/category/all?sk="+g);break;case"movie":window.history.replaceState(b,"",dynamic_site_url+"news/category/movie?sk="+g);break;case"tv":window.history.replaceState(b,"",dynamic_site_url+"news/category/tv?sk="+g)}$("#news_search").val(g),h(a),"undefined"!=typeof ga&&ga("send","event","\u65b0\u805e\u9996\u9801","\u641c\u5c0b",g)}else $("#newsIdxLoading").hide()}),$("#newsIdx_search_cancelBtn").on("click",function(){$("#newsIdxLoading").show(),f=!1,$("#mmNewsList").empty(),g="",$("#news_search_txt").val(""),a=1,d=!1,$(".mmExpand").hide(),$("#newsIdx_search_btn").removeClass("on"),$("#newsIdx_search_cancelBtn").hide(),$("#news_search").val("nwesIdx_search_empty"),l();var b={time:(new Date).getTime()};switch($("#news_category").val()){case"all":window.history.replaceState(b,"",dynamic_site_url+"news");break;case"movie":window.history.replaceState(b,"",dynamic_site_url+"news/category/movie");break;case"tv":window.history.replaceState(b,"",dynamic_site_url+"news/category/tv")}h(a)}),$(window).on("resize",function(){l()}),$(".fixTop").click(function(){$("html,body").stop(!0,!1).animate({scrollTop:0}),$(".fixTop").css({backgroundColor:"rgba(0,0,0,.7)"})}),$(document).on("click",".newsItem",function(){return event.preventDefault(),newsE=$(this),m(newsE.attr("href"),newsE.data("nid")),!1}),$(window).load(function(){setTimeout(function(){mNLM_firstStatus?n():(console.log("test"),nlsto())},1500)}),$(document).on("click",".mmExpand",function(){switch(c){case"all":f?$("#newsIdx_search_btn").click():$(".box1 div").eq(0).click();break;case"movie":f?$("#newsIdx_search_btn").click():$(".box1 div").eq(1).click();break;case"tv":f?$("#newsIdx_search_btn").click():$(".box1 div").eq(2).click()}$("this").hide()})});